2023 52 5 648 ~ 659
DOI 10. 13976 / j. cnki. xk. 2023. 2533 1002 - 0411 2023 - 05 - 0648 - 12
150001
LH2021E045 202102266002
zhanglanyong@ hrbeu. edu. cn / / 2022 - 11 - 21 /2023 - 02 - 24 /2023 - 03 - 13
LQR linear quadratic regulator
。 VMC virtual model control
。
Simulink Mulitibody 。
。
LQR
Matlab Simulink
VMC
TP24
A
Control of Wheel-legged Balancing Robot
CHEN Yang WANG Hongxi ZHANG Lanyong
College of Intelligent Systems Science and Engineering Harbin Engineering University Harbin 150001 China
Abstract
This work studies the overall control problem of a multiterrain adaptive wheel-legged inverted
pendulum robot. The dynamic model of the robot is also established. The linear quadratic regulator
LQR algorithm analyzes the decoupled balance and longitudinal motion subsystems and the
controller is designed. Based on virtual model control the torque in the inverted pendulum robot is
converted into the joint torque in the wheel-leg structure. The controller's performance is simulated
by building a simulation platform Simulink Mulitibody . The corresponding controller is designed
to control the robot's height and roll attitude. The performance of the whole controller is verified in
the robot which has certain theoretical and practical values.
Keywords
five-link wheel-legged
structure
balance control
linear quadratic regulator
LQR
Matlab Simulink
virtual model control VMC
integrated motion control
0
、
。
。
、、
。


。
Atlas、
Spot Handle 1
ANYmal 2 - 3 Ascento
4 - 5 Robotics X
Ollie
。 Ascento
5 WBC 6
。 WBC
。4
LQR
。7 8
LQR
。
7 -8
VMC 9
LQR 4 8
。
1
Fig.1 Whole robot
1
1.1
。
1.1.1
、
2
。
1、 2 。
2
Fig.2 Wheel-legged inverted pendulum model
1
Tab.1 Model variable definition of wheel-legged inverted pendulum
θ rad
α rad
φ rad
xm
xb x m
T θ N·m
Tp α N·m
NN
PN
Nf N
NM N
PM N
FN
649
5


2
Tab.2 Parameter definition of wheel-legged
inverted pendulum model
Rm
Lm
LM m
lm
mw kg
mp kg
M kg
Iw kg·m2
Ip kg·m2
IM kg·m2
1.1.2
mW x ̈ = Nf - N 1
IW
x ̈
R = T - NfR 2
1 、 2 Nf x ̈
x ̈ = T - NR
IW
R + mWR
3
N - NM = mp x ̈ + ∂2
∂t2 Lsinθ
()
= mp x ̈ + ∂
∂t L θ
·cosθ
()
= mp x ̈ + L θ ̈cosθ - L θ
·2 sinθ 4
P - PM - mpg = mp
∂2
∂t2 Lsinθ
= mp
∂
∂t - L θ
·sinθ
= mp - L θ
·2 cosθ - L θ ̈sinθ 5
Ip θ ̈ = PL + PMLM sinθ - NL + NMLM cosθ - T + Tp
6
NM = M θ ̈b + lφ2 sinφ - l φ ̈ cosφ 7
PM - Mg = M ∂2
∂t2 L + LM cosθ + lcosθ
= M - L + LM θ ̈sinθ - L + LM θ
·2 cosθ 
l φ ̈ sinφ - lφ2 cosφ 8
Im φ ̈ = Tp + NMlcosφ + PMlsinφ 9
x = xb - L + LM sinθ
x· = x·
b - L + LM θ
·cosθ
x ̈ = x ̈b - L + LM θ ̈cosθ + L + LM θ
·2 sinθ
1.1.3
x· = f x T Tp
Matlab 4 、
5、 7、 8
solve 3 、 6 、 9
。
xu
x=
θ
θ
·
xb
x·
b
φ
φ





· 
u= T
[ Tp]
xu
A = ∂f
∂x x u B = ∂f
∂u x u
x、u f x u = 0
x=
0
0
xb






0
0
0
u = [0]
0
x· =
0 100 0
A1 0 0 0 A2 0
A3 0 0 0 A4 0
0 000 0 1
A5 0 0 0 A6


  


 
0 
x+
00
B1 B2
00
B3 B4
00
B5 B
   


   

6 
u
10
。
650 52


y
y = I6 x
I6 6 。
AB 。
C。
1.1.4
Simscape Multibody
。
3
Fig.3 Simulation model of wheel-legged inverted pendulum
Matlab LQR
lqr K = lqr A B Q R
K。 Q R
。
Q R 1 1 100
50 300 1 1 1 。
1.2
1.2.1 LQR
u = - Kx = 
K11 K12 K13 K14 K15 K16
K21 K22 K23 K24 K25 K
[ 26 ]
θ
θ
·
xb
x·
b
φ
φ







· 
LQR K
J = ∫∞
0 xTQx + uTRu dt
Ju
u = - R - 1 BTPx
K
K = R -1BTP
P Riccati
ATP + PA - PBR - 1 BTP + Q = 0
。
u = K xd - x·
d
xd
xd =
0
0
xd
0.5x·
d






0
0
xd x·
d。
10 mm K。
L0 = L + LM
Kij L0 = p0 | ij + p1 | ij L0 + p2 | ij L2
0 + p3 | ij L3
0 11
u = K L0 xd - x
1.2.2 VMC
L0
。
Tp VMC virtual model
control Tp 。
4。
4
Fig.4 Planar five-link model and its parameters
4
xB + l2 cosφ2 = xD + l3 cosφ3
yB + l2 sinφ2 = yD + l3 sinφ
{
3
12
φ2
φ2 = 2arctan B0 + A2
0 + B2
0 -C
■
2 0
A0 + C0
651
5


A0 = 2l2 xD - xB
B0 = 2l2 yD - yB
C0 = l2
2 + l2
BD - L2
3
lBD = xD - xB
2 + yD - yB
■
2
φ2 C 。
VMC
。
。 task space
joint space
x=f q
x = L0 φ0
T q = φ1 φ4
T。 x
δL0 = ∂f1
∂φ1
∂φ1 + ∂f1
∂φ4
∂φ4
δφ0 = ∂f2
∂φ1
∂φ1 + ∂f2
∂φ4
∂φ




 4
δx =
∂f1 ∂φ1
∂f1 ∂φ4
∂f2 ∂φ1
∂f2 ∂φ

4 
δq
J
J=
∂f1 ∂φ1
∂f1 ∂φ4
∂f2 ∂φ1
∂f2 ∂φ

4 
δx = Jδq
J q·
x·。
TTδq + - F Tδx = 0
T = T1 T2
T
F = F Tp
T
F Tp 。 δx
= Jδq 12
T = JTF
。
1.2.3
VMC VMC
VMC
。
F = T2 cos φ0 - φ3
l4 sin φ3 - φ4
- T1 cos φ0 - φ2
l1 sin φ1 - φ2
13
T = L0
T1 cos φ0 - φ2 l1 sin φ1 - φ2
- T2 sin φ0 - φ3
l4 sin φ3 - φ4
( ) 14
13 、 14
T1 = - L1sin φ1 - φ2 Tcos φ0 - φ3 + FL0sin φ0 - φ3
L0sin φ2 - φ3
T2 = - L4sin φ3 - φ4 Tcos φ0 - φ2 + FL0sin φ0 - φ2
L0sin φ2 - φ3
1.3
Simscape Multibody
5。
5 Simscape
Fig.5 Simscape simulation model
L0 = 0.18
x· =
0 100 0 0
265.955 6 0 0 0 80.632 7 0
0 001 0 0
- 25.456 2 0 0 0 1.863 7 0
0 000 0 1
156.695 2 0 0 0 183.



 





061 4 0
x+
00
- 15.138 9 13.856 3
00
2.120 8 - 0.715 8
00
- 4.223 8 16.

 



 


800 1
u
C
rank C = rank B AB A2 B ... A5 B = 6
652 52


。 LQR
Q=
10 0 0 0 0
01 0 0 0 0
0 0 500 0 0 0
0 0 0 100 0 0
0 0 0 0 5 000 0






00 0 0 0 1
R= 1 0
0 0.
[]
25
Riccati K
K
= -44.378 8 -6.849 6 -22.282 8 -21.556 9 28.770 6 4.375 1
11.200 6 0.733 9 3.730 0 3.205 8 151.730 04.
[]
638 7 x·
dt
x·
d t = 1.5 t < 3
0 t≥
{
3
xd t
xd t
xd t =
0
0
xd t






0
0
0
6。
6
Fig.6 Simulation verification robot pose performance
、θ
7。
、
。
。
PID VMC
8
。
VMC
PID
。
7
Fig.7 Simulation verification robot pose curve
8
Fig.8 Comparison of simulation robot pose performance
9
。
LQR + VMC
。
1.4
。
1 /4 50 N
10 。
653
5


9
Fig.9 Comparison of simulation robot pose curve
10
Fig.10 Robot pose performance under external force
disturbance time sequence from right to left
。
。
、
11 。
、
。
。
11
Fig.11 Robot pose curve under external disturbance
1.5
。
。
。
IMU
。
。
。
11 12 。
654 52


12
Fig.12 Feedback matrix fitting results
2 m/s
13 。
13
Fig.13 Real robot and pose performance
φ、 θ
14 。
。
t = 1.6 s 2 m/s
φ±
13°
。
1.6
。
ωe、
14
Fig.14 Real machine effect robot pose curve
c
b φ·
bc
、e
ωeb 。 3
ω
ω = ωeb + φ·
bc + ωecd
655
5


x·
x· = ωR
xb x = xb 
L0 sinθ
x·
b = x· + L0 θ·cosθ + L·
0 sinθ
x·
b = ωR + L0 θ·cosθ + L·
0 sinθ
2
。
。
2.1
2.1.1
PD 。
ψd
^ψ PD
T 1 Tp 、r Tr 。
2.1.2
“” 。
δθ = r θ - 1 θ PD
。
Tp
1 Tp 、r Tp 。
2.2
2.2.1
PD
。
“PID + ”
1 L0 、r L0 。
1 Ld 、r Ld
γd
。
2.2.2
Kp 。 Kp
“PID + ”
。
PID PI
PID
F。
。
。
δγ = γd - ^γ Kγ
1 F、r F。
15 。
15
Fig.15 Terrain adaptability of the robot
2.3
、
。 VMC
4。
46
16
。
3
。
656 52


16
Fig.16 Block diagram of integrated robot motion control system
。
3.1
。
FN 17 。
17
Fig.17 Simplified model of the robot
FN - P - mw g = mw z ̈w
P
P≈Fcosθ + Tpsinθ
L0
F、Tp 。z ̈w
z ̈w = d2
dt2 zM - L0 cosθ
= z ̈M - L ̈0 cosθ + 2L·
0 θ·sinθ + L0 θ ̈sinθ + L0 θ·2 cosθ
z ̈M
。
3.2
20 cm 18
。
19 。
t = 0.3 s t = 1.05 s
FN 。 t =
1.27 s FN
。 t = 2. 5 s
。
FN < 20 N
657
5


K21 、K22
0。
20 。
18
Fig.18 Robot off the ground
19
Fig.19 The calculating value of the supporting force
of the left and right wheels of the robot
5
20
Fig.20 Attitude change of robot during lifting off the ground
“ ”。
4
。
。
。
。
。
。
1 Handle. Accessed 29. 07. 2018 EB / OL . 2018 - 06 - 06 2022 - 02 - 16 . https / / www. bostondynamics. com / handle.
2 BJELONIC M BELLICOSO C D DE VIRAGH Y et al. Keep rollin-whole-body motion control and planning for wheeled quad
rupedal robots J . IEEE Robotics and Automation Letters 2019 4 2 2116 - 2123.
3 BJELONIC M SANKAR P K BELLICOSO C D et al. Rolling in the deep-hybrid locomotion for wheeled-legged robots using
online trajectory optimization J . IEEE Robotics and Automation Letters 2020 5 2 3626 - 3633.
4 KLEMM V MORRA A SALZMANN C et al. Ascento A two-wheeled jumping robot C / / International Conference on Robot
ics and Automation. Piscataway USA IEEE 2019 7515 - 7521.
5 KLEMM V MORRA A GULICH L et al. LQR-assisted whole-body control of a wheeled bipedal robot with kinematic loops
J . IEEE Robotics and Automation Letters 2020 5 2 3745 - 3752.
658 52


6 BELLICOSO C D GEHRING C HWANGBO J et al. Perception-less terrain adaptation through whole body control and hierar
chical optimization C / / IEEE-RAS 16th International Conference on Humanoid Robots. Piscataway USA IEEE 2016
558 - 564.
7 WANG S CUI L L ZHANG J F et al. Balance control of a novel wheel-legged robot Design and experiments C / / IEEE In
ternational Conference on Robotics and Automation. Piscataway USA IEEE 2021 6782 - 6788.
8 . J . 2007 39 6 940 
943.
YU H Y TANG D W WANG J Y. Analysis of the kinematic and dynamic characteristics of a planar five-bar mechanism J .
Journal of Harbin Institute of Technology 2007 39 6 940 - 943.
9 . J . 2014 36 4 146 - 151.
XIE H X LUO Z R SHANG J Z. Dynamic control for quadrupedal trotting locomotion J . Journal of National University of
Defense Technology 2014 36 4 146 - 151.
10 BELLICOSO C D JENELTEN F FANKHAUSER P et al. Dynamic locomotion and whole-body control for quadrupedal robots
C / / IEEE / RSJ International Conference on Intelligent Robots and Systems. Piscataway USA IEEE 2017 3359 - 3365.
11 CASTANO J A HOFFMAN E M LAURENZI A et al. A whole body attitude stabilizer for hybrid wheeled-legged quadruped
robots C / / IEEE International Conference on Robotics and Automation. Piscataway USA IEEE 2018 706 - 712.
12 SHEN Y CHEN G LI Z et al. Cooperative control strategy of wheel-legged robot based on attitude balance J . Robotica
2022 41 2 566 - 586.
13 KIM H W JUNG S. Fuzzy control for balancing of a two-wheel transportation robotic vehicle experimental studies C / /9th A
sian Control Conference. Piscataway USA IEEE 2013 1 - 5.
14 WANG S LU H HOU F. An improved computing model for a two-wheeled self-balancing vehicle's state determination C / /
8th International Congress on Image and Signal Processing. Piscataway USA IEEE 2015 1379 - 1384.
15 SONG G YIN K ZHOU Y et al. A surveillance robot with hopping capabilities for home security J . IEEE Transactions on
Consumer Electronics 2009 55 4 2034 - 2039.
16 ZHANG K WANG J Z PENG H et al. Model predictive control based path following for a wheel-legged robot C / /32nd Chi
nese Control and Decision Conference. Piscataway USA IEEE 2020 3925 - 3930.
17 LEE J BJELONIC M HUTTER M. Control of wheeled-legged quadrupeds using deep reinforcement learning C / /25th Inter
national Conference on Climbing and Walking Robots and Mobile Machine Support Technologies. Piscataway USA IEEE
2022 119 - 127.
18 JIA Q CAO X SUN H et al. A novel design of a two-wheeled robot C / /2nd IEEE Conference on Industrial Electronics and
Applications. Piscataway USA IEEE 2007 1226 - 1231.
19 CUI L. Nonlinear balance control of an unmanned bicycle Design and experiments C / / IEEE / RSJ International Conference on
Intelligent Robots and Systems. Piscataway USA IEEE 2020 7279 - 7284.
20 . J . 2013 30 2 331 - 335.
GAO J GE W J. Research of fuzzy adaptive controller for single joint hopping robot J . Computer Simulation 2013 30 2
331 - 335.
21 . J . 2012 34 1 32 - 37 43.
BAI L GE W J CHEN X H et al. Design and implementation of a bio-inspired intermittent hopping robot for planetary surface
exploration J . Robot 2012 34 1 32 - 37 43.
22 . J . 2022 48 9
2164 - 2174.
HAN L Q CHEN X C YU Z G er al. Balance control of underactuated biped robot for discrete terrain J . Acta Automatica
Sinica 2022 48 9 2164 - 2174.
2001 - 。 。
2001 - 。 。
1983 - 。 。
659
5